# Spec Tasks

## Tasks

- [ ] 1. Create Core Type Infrastructure - Target System
  - [ ] 1.1 Write tests for PlayerRef and ZoneType type guards
  - [ ] 1.2 Create `src/game-logic/targets.ts` with PlayerRef, ZoneType, CardState, and ComparisonOperator types
  - [ ] 1.3 Write tests for CardFilter type validation
  - [ ] 1.4 Implement CardFilter type with all filter properties (cardType, colors, traits, name, level, cost, ap, hp, state, isLinkUnit, linkPilotTraits)
  - [ ] 1.5 Write tests for EffectTarget discriminated union
  - [ ] 1.6 Implement complete EffectTarget discriminated union with all target types (self, paired-unit, paired-pilot, card, player, shield)
  - [ ] 1.7 Write type guard functions for EffectTarget type narrowing
  - [ ] 1.8 Verify all tests pass for gundam-engine package
  - [ ] 1.9 Verify linter rules pass for gundam-engine package
  - [ ] 1.10 Verify type safety by running typecheck and iterate until it passes
  - [ ] 1.11 Use the code-reviewer subagent to review the code
  - [ ] 1.12 Find tasks.md file and update it so the task is marked as complete

- [ ] 2. Create Duration and Condition Systems
  - [ ] 2.1 Write tests for EffectDuration type validation
  - [ ] 2.2 Create `src/game-logic/durations.ts` with EffectDuration discriminated union (permanent, until-end-of-turn, until-end-of-battle, until-leaves-zone, while-condition)
  - [ ] 2.3 Write tests for ConditionDefinition type validation and composition
  - [ ] 2.4 Create `src/game-logic/conditions.ts` with ConditionDefinition discriminated union including all condition types (is-link-unit, is-paired, has-pilot-with-traits, card-property, phase, during-battle, during-attack, and, or, not)
  - [ ] 2.5 Write tests for condition composition (AND, OR, NOT operators)
  - [ ] 2.6 Add type guards for condition type narrowing
  - [ ] 2.7 Verify all tests pass for gundam-engine package
  - [ ] 2.8 Verify linter rules pass for gundam-engine package
  - [ ] 2.9 Verify type safety by running typecheck and iterate until it passes
  - [ ] 2.10 Use the code-reviewer subagent to review the code
  - [ ] 2.11 Find tasks.md file and update it so the task is marked as complete

- [ ] 3. Create Effect Action Types and Cost System
  - [ ] 3.1 Write tests for card movement effect actions (move-card, draw-cards, discard-cards, shuffle-deck)
  - [ ] 3.2 Create `src/game-logic/effects.ts` and implement card movement effect actions
  - [ ] 3.3 Write tests for deployment effect actions (deploy-unit, deploy-base, pair-pilot)
  - [ ] 3.4 Implement deployment effect actions
  - [ ] 3.5 Write tests for state change effect actions (rest-card, set-active, destroy-card, remove-card)
  - [ ] 3.6 Implement state change effect actions
  - [ ] 3.7 Write tests for combat effect actions (deal-damage, recover-hp)
  - [ ] 3.8 Implement combat effect actions
  - [ ] 3.9 Write tests for modification effect actions (modify-stats, grant-keyword, grant-ability)
  - [ ] 3.10 Implement modification effect actions
  - [ ] 3.11 Write tests for search and special effect actions (search-deck, reveal-cards, look-at-cards, place-resource, change-attack-target, prevent-damage, create-token)
  - [ ] 3.12 Implement search and special effect actions
  - [ ] 3.13 Write tests for ActivationCost discriminated union
  - [ ] 3.14 Implement ActivationCost type with all cost types (rest-this, rest-card, destroy-card, pay-resources, discard-cards, and)
  - [ ] 3.15 Create complete EffectAction discriminated union combining all action types
  - [ ] 3.16 Write type guards for EffectAction type narrowing
  - [ ] 3.17 Verify all tests pass for gundam-engine package
  - [ ] 3.18 Verify linter rules pass for gundam-engine package
  - [ ] 3.19 Verify type safety by running typecheck and iterate until it passes
  - [ ] 3.20 Use the code-reviewer subagent to review the code
  - [ ] 3.21 Find tasks.md file and update it so the task is marked as complete

- [ ] 4. Create Complete Ability Type System
  - [ ] 4.1 Write tests for BaseAbility structure with restrictions
  - [ ] 4.2 Create `src/cards/ability-types.ts` and implement BaseAbility type
  - [ ] 4.3 Write tests for ConstantAbility type
  - [ ] 4.4 Implement ConstantAbility type with condition support
  - [ ] 4.5 Write tests for TriggeredAbility type with all trigger types
  - [ ] 4.6 Implement TriggeredAbility type (ON_DEPLOY, ON_ATTACK, ON_DESTROY, ON_BURST, WHEN_PAIRED, WHEN_UNIT_ATTACKS, WHEN_UNIT_DESTROYED, START_OF_TURN, END_OF_TURN, WHEN_DAMAGE_DEALT, WHEN_DAMAGE_RECEIVED)
  - [ ] 4.7 Write tests for ActivatedAbility type
  - [ ] 4.8 Implement ActivatedAbility type with MAIN/ACTION timing and cost support
  - [ ] 4.9 Write tests for CommandAbility type
  - [ ] 4.10 Implement CommandAbility type with MAIN/ACTION/BURST timing
  - [ ] 4.11 Write tests for SubstitutionAbility type
  - [ ] 4.12 Implement SubstitutionAbility type
  - [ ] 4.13 Create complete AbilityDefinition discriminated union
  - [ ] 4.14 Write type guards for AbilityDefinition type narrowing
  - [ ] 4.15 Verify all tests pass for gundam-engine package
  - [ ] 4.16 Verify linter rules pass for gundam-engine package
  - [ ] 4.17 Verify type safety by running typecheck and iterate until it passes
  - [ ] 4.18 Use the code-reviewer subagent to review the code
  - [ ] 4.19 Find tasks.md file and update it so the task is marked as complete

- [ ] 5. Update Card Type Definitions and Create Utilities
  - [ ] 5.1 Write tests for updated UnitCardDefinition with new ability system
  - [ ] 5.2 Update `src/cards/card-types.ts` to import and use AbilityDefinition for UnitCardDefinition
  - [ ] 5.3 Write tests for updated PilotCardDefinition with new ability system
  - [ ] 5.4 Update PilotCardDefinition to use AbilityDefinition
  - [ ] 5.5 Write tests for updated CommandCardDefinition with new ability system
  - [ ] 5.6 Update CommandCardDefinition to use AbilityDefinition
  - [ ] 5.7 Write tests for updated BaseCardDefinition_Structure with new ability system
  - [ ] 5.8 Update BaseCardDefinition_Structure to use AbilityDefinition
  - [ ] 5.9 Write tests for backward compatibility with old ParsedAbility (deprecated)
  - [ ] 5.10 Mark ParsedAbility as deprecated and add migration comments
  - [ ] 5.11 Create `src/utils/type-guards.ts` with comprehensive type guard suite
  - [ ] 5.12 Write tests for all type guard functions (isConstantAbility, isTriggeredAbility, isActivatedAbility, isCommandAbility, isSubstitutionAbility, isCardTarget, isPlayerTarget, etc.)
  - [ ] 5.13 Verify all tests pass for gundam-engine package
  - [ ] 5.14 Verify linter rules pass for gundam-engine package
  - [ ] 5.15 Verify type safety by running typecheck and iterate until it passes
  - [ ] 5.16 Use the code-reviewer subagent to review the code
  - [ ] 5.17 Find tasks.md file and update it so the task is marked as complete

- [ ] 6. Create Example Cards and Exhaustiveness Test
  - [ ] 6.1 Write test for exhaustive effect action handler (ensures all EffectAction types are handled)
  - [ ] 6.2 Create mock effect executor function in test that switches over all EffectAction types
  - [ ] 6.3 Verify TypeScript compiler enforces exhaustiveness (test should fail to compile if any action type is missing)
  - [ ] 6.4 Create example card 1: Simple unit with triggered ability (e.g., Guncannon with WHEN_PAIRED rest effect)
  - [ ] 6.5 Create example card 2: Unit with activated ability and cost (e.g., Base with Activate-Main effect)
  - [ ] 6.6 Create example card 3: Command card with multiple timing (e.g., BURST + MAIN/ACTION)
  - [ ] 6.7 Create example card 4: Unit with constant ability and condition (e.g., Pilot with conditional stat boost)
  - [ ] 6.8 Create example card 5: Complex unit with multiple abilities and keyword grants
  - [ ] 6.9 Write validation tests for all example cards (type checking, structure validation)
  - [ ] 6.10 Create migration guide document showing old ParsedAbility â†’ new AbilityDefinition conversion
  - [ ] 6.11 Add comprehensive JSDoc comments to all exported types in ability-types.ts, effects.ts, targets.ts, conditions.ts, durations.ts
  - [ ] 6.12 Verify all tests pass for gundam-engine package
  - [ ] 6.13 Verify linter rules pass for gundam-engine package
  - [ ] 6.14 Verify type safety by running typecheck and iterate until it passes
  - [ ] 6.15 Use the code-reviewer subagent to review the code
  - [ ] 6.16 Find tasks.md file and update it so the task is marked as complete

