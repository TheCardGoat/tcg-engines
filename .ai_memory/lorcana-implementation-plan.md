# Lorcana Card Parser Improvement & Implementation Plan

## Executive Summary

Implement **423 Lorcana cards** (Sets 1-3+) while iteratively improving parser v2 through learning-driven development.

**Key Discovery**: Set 1 (204 cards) is **already complete**. The project scope is implementing Sets 2-3.

---

## Documents

This plan is organized into three documents:

| Document | Purpose | Location |
|----------|---------|----------|
| **Plan** (this file) | High-level overview and TODO list | `.ai_memory/lorcana-implementation-plan.md` |
| **Strategy** | Vision, objectives, strategic pillars | `.ai_memory/lorcana-implementation-strategy.md` |
| **Tactics** | Daily workflow, commands, best practices | `.ai_memory/lorcana-implementation-tactics.md` |

---

## Current Status

| Metric | Value |
|--------|-------|
| **Set 1 (TFC)** | ✅ Complete (204 cards) |
| **Set 2 (RotF)** | ❌ Missing (204 cards) |
| **Set 3 (ItI)** | ❌ Missing (~200 cards) |
| **Parser v2** | Hybrid: manual → keyword → grammar → regex |
| **Parser Coverage** | ~20% on legacy cards |
| **Existing Agents** | lorcana-card-migration, lorcana-test-writer |

---

## Implementation Approach

### Order: By Card Type Group (Cross-Set)

```
Phase 1: ALL Actions (Sets 2-3)    ~160 cards
Phase 2: ALL Items (Sets 2-3)      ~80 cards
Phase 3: ALL Characters (Sets 2-3) ~280 cards
```

**Rationale**: Build pattern libraries efficiently. Actions teach trigger/effect patterns. Items teach durability/static effects. Characters apply all patterns.

### Per-Card Workflow (5 minutes)

1. **Find Reference** (30s): Use `pattern-matcher` to find similar cards
2. **Write Test** (1 min): Use `lorcana-test-writer` (TDD - RED phase)
3. **Implement Card** (2 min): Use `lorcana-card-migrator` with parser v2
4. **Verify** (30s): Run tests, type-check, format, lint
5. **Capture Learning** (1 min): Document parser result, patterns, issues

### Weekly Cycle

- **Mon-Thu**: Implement cards (target: 10/day)
- **Fri**: Parser improvement cycle (analyze failures → improve parser → validate)

---

## Subagents to Create

| Subagent | Purpose | Priority |
|----------|---------|----------|
| `batch-card-processor` | Process 10+ similar cards in batch | HIGH |
| `parser-improver` | Analyze failures, improve parser | HIGH |
| `pattern-matcher` | Find similar implemented cards | MEDIUM |
| `learning-aggregator` | Compile learnings into insights | MEDIUM |

**Creation Timeline**: Create all 4 subagents BEFORE starting card implementation (based on lorcanito patterns).

---

## Targets

| Metric | Baseline | Target | Timeline |
|--------|----------|--------|----------|
| Cards Implemented | 204 | 423 | 14 weeks |
| Parser Coverage | 20% | 80% | 14 weeks |
| Manual Overrides | 143 | <220 | 14 weeks |
| Test Coverage | 100% | 100% | Ongoing |
| Avg Time/Card | ~5 min | ~1 min | 14 weeks |

---

## Critical Files

### Parser Core
- `packages/lorcana-cards/src/parser/v2/index.ts` - Main parser
- `packages/lorcana-cards/src/parser/v2/effects/atomic/index.ts` - Atomic parsers
- `packages/lorcana-cards/src/parser/v2/effects/composite/index.ts` - Composite parsers
- `packages/lorcana-cards/src/parser/v2/manual-overrides.ts` - Manual overrides

### Card Implementation
- `packages/lorcana-cards/src/cards/002/` - Set 2 (target)
- `packages/lorcana-cards/src/cards/003/` - Set 3 (future)

### Agents
- `.claude/agents/batch-card-processor.md` - NEW
- `.claude/agents/parser-improver.md` - NEW
- `.claude/agents/pattern-matcher.md` - NEW
- `.claude/agents/learning-aggregator.md` - NEW

### Memory Bank
- `.ai_memory/lorcana-set-002-003-implementation.md` - Main implementation log
- `.ai_memory/learning/set-002-learning.json` - Autogenerated learnings

---

## First Steps (Day 1-2)

### Day 1: Setup
```bash
# 1. Create Memory Bank
cp .ai_memory/TEMPLATE.md .ai_memory/lorcana-set-002-003-implementation.md

# 2. Create subagents (using skill-creator)
/lore:skill-create batch-card-processor
/lore:skill-create parser-improver
/lore:skill-create pattern-matcher
/lore:skill-create learning-aggregator

# 3. Validate Set 1
bun test packages/lorcana-cards/src/cards/001
```

### Day 2: First Cards
```bash
# 1. Implement first batch (10 action cards from Set 2)
/lore:batch-card-processor --set=002 --type=action --count=10

# 2. Run first parser improvement cycle
/lore:parser-improver

# 3. Document learnings
/lore:memory-bank
```

---

## Quality Gates

**Per Card**: Test ✓ Type-check ✓ Format ✓ Lint ✓ Learning captured

**Per Batch (10 cards)**: All tests ✓ CI checks ✓ Sample Gauntlet ✓

**Per Week**: Parser validation ✓ Weekly report ✓ Gauntlet review ✓

---

## Risk Mitigation

| Risk | Mitigation |
|------|------------|
| Parser stalls at 50% | Accept 30% manual override rate |
| Complex patterns | Manual override + document as edge case |
| Implementation falls behind | Reduce daily target, focus on Sets 1-2 |
| Systemic issues | Pause, fix root cause, re-validate |

---

## Summary

This plan implements **423 Lorcana cards** through a **learning-driven** approach:

1. **Strategy**: Test-Driven Development, Iterative Parser Enhancement, Type-Group Order, Learning Capture, Subagent Automation
2. **Tactics**: Daily 5-minute workflow per card, Weekly parser improvement cycle, Quality gates at every level
3. **Execution**: 14-week timeline, starting with subagent creation, then Set 2 Actions → Items → Characters

**Key Success Factor**: Every card teaches us how to make the next one faster through documented learnings and parser improvements.

---

## References

- **Strategy**: `.ai_memory/lorcana-implementation-strategy.md`
- **Tactics**: `.ai_memory/lorcana-implementation-tactics.md`
- **Implementation Log**: `.ai_memory/lorcana-set-002-003-implementation.md`
- **Lorcanito Reference**: `/Users/wazar/projects/lorcanito/`
- **Parser v2**: `packages/lorcana-cards/src/parser/v2/`
- **Existing Agents**: `.claude/agents/lorcana-card-migration.md`, `.claude/agents/lorcana-test-writer.md`
